# [2025-11-18] 세션 작업 로그

## 🎯 오늘의 목표
-   새로운 네트워크 환경(학교)에서의 로컬 개발 환경 설정
-   앱 실행 시 발생하는 에셋 로딩 및 코드 동기화 오류 해결
-   '찜하기' 기능의 `401` 인증 오류 해결
-   매번 IP 주소를 변경하는 번거로움을 없애기 위해, 백엔드 서버를 클라우드에 영구적으로 배포

## 💻 1단계: 네트워크 환경 변경 및 로컬 서버 재설정

-   **문제 발생:** 사용자가 학교 네트워크에 접속함에 따라, 클라이언트 앱이 로컬 백엔드 서버에 접속하기 위한 IP 주소 변경이 필요해짐.
-   **진행 과정:**
    1.  `ifconfig` 명령어를 통해 새로운 로컬 IP 주소(`192.168.201.137`)를 확인.
    2.  `cinemind-client/constants/config.ts` 파일의 `API_BASE_URL`을 새 IP 주소로 수정.
    3.  사용자의 요청에 따라, 향후 직접 IP를 변경할 수 있도록 상세한 가이드라인을 `ip_change_guide.md` 파일로 작성하여 제공.

## 💻 2단계: 에셋 로딩 실패 오류 디버깅

-   **문제 발생:** IP 주소 변경 후에도 앱 로딩 시 `Unable to download asset ... FontAwesome.ttf` 오류가 발생하며 앱이 정상 실행되지 않음.
-   **진단 및 해결 과정:**
    1.  **가설 1: Metro 캐시 오류**
        -   **시도:** `npm start -- -c` 명령어로 클라이언트 개발 서버의 캐시를 초기화.
        -   **결과:** 동일 오류가 재발생하며 캐시 문제가 아님을 확인.
    2.  **가설 2: 네트워크 차단**
        -   **분석:** 학교 네트워크의 보안 정책(AP 격리 등)이 핸드폰과 컴퓨터 간의 통신을 막고 있을 것으로 추정.
        -   **시도:** 핸드폰 브라우저에서 개발 서버 주소(`http://192.168.201.137:8081`)로 접속을 시도하는 테스트를 요청.
    3.  **새로운 오류 발견 (Red Herring):**
        -   테스트 진행 중, `ExpoSecureStore.default.getValueWithKeyAsync is not a function` 라는 새로운 코드 오류가 스크린샷으로 확인됨.
        -   **분석:** `utils/api.ts` 파일을 확인한 결과, 실제 코드에는 이미 올바른 함수인 `getItemAsync`가 사용되고 있었음.
        -   **결론:** 이 오류는 **"유령 오류"**로, 네트워크 차단으로 인해 핸드폰이 최신 코드를 받지 못하고 예전의 버그가 있는 코드를 실행하며 발생한 것임. 모든 문제의 근본 원인은 **네트워크 차단**임을 확신.
    4.  **가설 3: 모바일 핫스팟 우회**
        -   **시도:** 학교 네트워크를 우회하기 위해 핸드폰의 모바일 핫스팟에 컴퓨터를 연결하고, 새로 할당된 IP(`192.0.0.2`)로 `config.ts`를 재설정.
        -   **결과:** `The Internet connection appears to be offline` 오류가 발생. 핫스팟 환경에서도 기기 간 통신이 원활하지 않음을 확인.

## 💻 3단계: '찜하기' 기능 인증 오류 해결

-   **문제 발생:** 사용자가 네트워크 문제가 해결된 것 같다고 하여 다음 작업으로 넘어감. '찜하기' 버튼 클릭 시, "찜하기 상태 변경에 실패했습니다" 라는 오류가 발생. 백엔드 로그에서는 `401 Unauthorized` 확인.
-   **진단:** API 요청 시 인증 토큰이 누락되었거나 유효하지 않음.
-   **분석:**
    1.  `explore.tsx` 파일의 `handleToggleLike` 함수가 `authenticatedFetch`를 올바르게 사용하고 있음을 확인.
    2.  `AuthContext.tsx` 파일에서 토큰을 저장하고 불러오는 로직 또한 `TOKEN_KEY`를 공유하며 정상적으로 구현되어 있음을 확인.
    3.  **최종 결론:** 코드는 정상이지만, 앱의 현재 로그인 상태가 비정상적(소위 "유령 로그인" 상태)이라고 판단. 즉, 앱은 로그인 상태로 인식하지만 기기에는 유효한 토큰이 없는 상태.
-   **해결:**
    -   가장 확실한 해결책으로 **'로그아웃 후 재로그인'**을 제안. 이를 통해 기존의 비정상적인 세션을 파기하고, 서버로부터 새롭고 유효한 토큰을 발급받아 기기에 정상적으로 저장하도록 유도.
    -   사용자가 로그아웃 후 재로그인하자, '찜하기' 기능이 완벽하게 정상 작동함을 확인.

## 💻 4단계: 백엔드 서버 클라우드 배포 (Render)

-   **목표:** 매번 IP 주소를 변경해야 하는 근본적인 문제를 해결하기 위해, 백엔드 서버를 인터넷 클라우드에 배포하여 영구적인 공개 주소를 갖도록 함.
-   **진행 과정:**
    1.  **배포 서비스 선정:** 초보자가 사용하기 쉽고 무료 플랜을 제공하는 **Render.com**을 추천.
    2.  **코드 준비 (1):** 실제 서비스 환경에 적합한 `gunicorn` 웹 서버를 `cinemind-backend/requirements.txt`에 추가.
    3.  **코드 준비 (2):** GitHub에 비밀 키(`.env`)가 올라가지 않도록, `cinemind-backend/.gitignore` 파일을 생성하고 내용을 작성.
    4.  **GitHub 업로드:** 사용자가 `git` 명령어(`init`, `add`, `commit`, `remote add`, `branch -M`, `push`)를 통해 프로젝트를 GitHub 저장소에 업로드하도록 안내. 발생하는 자잘한 오류(`remote already exists`, `src refspec main does not match`)들을 해결하며 성공적으로 업로드 완료.
    5.  **Render 서비스 생성:** Render 대시보드에서 GitHub 저장소를 연결하고, 아래와 같이 Web Service를 설정하도록 상세히 안내.
        -   **Root Directory:** `cinemind-backend` (하위 폴더에 있는 백엔드를 인식시키기 위함)
        -   **Start Command:** `gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app` (프로덕션 환경용 실행 명령어)
        -   **Environment Variables:** 로컬의 `.env` 파일에 있는 모든 비밀 키들을 Render의 환경 변수 설정에 하나씩 복사하여 추가하도록 안내.
    6.  **배포 완료 및 최종 설정:**
        -   배포가 성공적으로 완료되어, 영구 주소 `https://cinemind-backend.onrender.com`가 생성됨.
        -   `cinemind-client/constants/config.ts` 파일의 `API_BASE_URL`을 이 새로운 주소로 마지막으로 업데이트하도록 안내.

## ✅ 세션 최종 요약 및 현재 상태

-   **해결된 문제:** 로컬 네트워크 환경 문제, 에셋 로딩 실패, `ExpoSecureStore` 코드 오류, '찜하기' 인증 오류 등 세션 초반의 모든 블로킹 이슈가 해결됨.
-   **주요 성과:** 백엔드 서버가 **Render 클라우드에 성공적으로 배포**되었으며, 클라이언트 앱은 이제 IP 주소 변경 없이 영구적인 URL을 통해 서버와 통신함.
-   **현재 상태:** 앱의 핵심 기능들이 안정적인 클라우드 백엔드와 연동되어, 언제 어디서든 일관되게 작동하는 완전한 애플리케이션의 형태를 갖추게 됨.
-   **기타:** 배포 후 서버 관리(재시작, 삭제), 무료 플랜의 특징, 클라이언트 앱의 배포(빌드) 개념 등 추가적인 질문에 대해 상세히 안내함.
