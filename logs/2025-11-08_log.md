[역할 부여]
너는 10년 차 리액트 네이티브 개발자야.

# CineMind 프로젝트 전체 작업 로그

## [2025-11-08] - 앱 프로토타입 전체 구축 및 심층 디버깅

### 🎯 목표
- 사용자의 프로젝트 제안서와 HTML 목업을 기반으로, 실제 데이터 연동 및 핵심 기능(인증, 추천 등)이 포함된 CineMind 모바일 앱의 완전한 초기 프로토타입을 구축하고, 발생하는 모든 오류를 해결하여 안정적인 상태로 만드는 것을 목표로 합니다.

### 💻 1단계: 초기 기능 구현

#### Frontend (`cinemind-client`)
- **UI 화면 전체 구현:**
  - `app/(auth)/login.tsx`, `signup.tsx`: 목업 기반의 인증 화면 UI 구현.
  - `app/onboarding/...`: 3단계(기분 선택, 카드 스와이프, 완료) 온보딩 플로우 UI 구현.
  - `app/(tabs)/...`: 홈, 추천, 검색, 프로필 탭을 포함한 메인 화면 UI 및 네비게이터 구현.
- **재사용 컴포넌트 생성:**
  - `MovieCard`, `MovieModal`, `RecommendCard`, `SwipeCard` 등 다양한 컴포넌트 생성.
- **전역 상태 관리:**
  - `context/AuthContext.tsx`: 앱의 로그인 상태, 사용자 정보, 인증 토큰을 전역적으로 관리하는 컨텍스트 생성.
- **라이브러리 설치:**
  - `react-native-chart-kit`, `react-native-svg`: 차트 시각화.
  - `expo-secure-store`: 인증 토큰의 안전한 저장.

#### Backend (`cinemind-backend`)
- **API 엔드포인트 구축:**
  - 인증: `/signup`, `/login`, `/auth/check-email`, `/auth/check-username`
  - 영화 정보: `/movies/box-office`, `/movies/{movie_cd}`
  - 사용자 활동: `/ratings`
  - 추천: `/movies/recommendations`
- **서비스 로직 구현:**
  - `kobis_service.py`: KOBIS API를 호출하여 영화 정보를 가져오는 로직.
  - `recommendation_service.py`: 사용자 평점을 기반으로 영화를 추천하는 초기 버전 로직.
- **데이터베이스 연동:**
  - `supabase_client.py`: Supabase 접속을 위한 일반 및 관리자용 클라이언트 설정.
  - `.env`: 모든 API 키(Supabase, KOBIS)를 안전하게 관리.

#### 데이터베이스 (Supabase)
- **테이블 설계 및 생성 안내:**
  - `profiles`: 사용자 정보(아이디, 이메일) 저장을 위한 테이블. `username`에 `UNIQUE` 제약 조건 추가.
  - `user_ratings`: 사용자 평점 저장을 위한 테이블.
- **보안 정책(RLS) 설정 안내:**
  - `profiles` 테이블에 "사용자 본인만 자신의 프로필을 추가할 수 있다"는 RLS 정책을 추가하여 보안 및 데이터 무결성 확보.

---

### 💻 2단계: 디버깅 및 기능 개선 과정

#### 발생 문제 1: `Network request failed` (모바일)
- **진단:** iOS의 ATS 보안 정책이 암호화되지 않은 로컬 서버(http://...)로의 통신을 차단.
- **시도한 해결책:** `app.json`에 `NSAppTransportSecurity` 설정을 추가하여 HTTP 통신을 허용. -> **해결됨.**

#### 발생 문제 2: 백엔드 서버 충돌 (`email-validator` 부재)
- **진단:** Pydantic의 `EmailStr` 타입이 요구하는 `email-validator` 패키지가 설치되지 않아 서버 시작 실패.
- **시도한 해결책:** `pip install 'pydantic[email]'` 명령어로 의존성을 설치하고 `requirements.txt`에 반영. -> **해결됨.**

#### 발생 문제 3: 웹페이지 텍스트 입력 불가
- **진단:** `KeyboardAvoidingView` 등 모바일 전용 컴포넌트가 웹 환경과 충돌하여 입력 필드의 포커스를 방해.
- **시도한 해결책:** `Platform.OS`를 사용하여 웹 환경에서는 해당 컴포넌트들이 렌더링되지 않도록 조건부 로직 추가. -> **해결됨.**

#### 발생 문제 4: 회원가입 시 RLS 정책 위반 오류
- **진단:** 백엔드 서버가 익명 키(`anon` key)로 `profiles` 테이블에 데이터 삽입을 시도하여, "본인만 추가 가능"이라는 RLS 정책에 막힘.
- **시도한 해결책:** `service_role` 키를 사용하는 관리자용 클라이언트(`supabase_admin`)를 생성하고, 프로필 정보 저장 시에만 이 클라이언트를 사용하도록 백엔드 로직 수정. -> **해결됨.**

#### 발생 문제 5 (현재 미해결): `[object Object]` 및 `Render Error`
- **진단:**
  1. 로그인/회원가입 실패 시, 백엔드가 보낸 오류 데이터를 프론트엔드가 제대로 해석하지 못해 `[object Object]`가 표시됨.
  2. 앱 실행 시 `Attempted to navigate before mounting...` 오류가 발생하며 충돌.
- **시도한 해결책:**
  1. **오류 처리 로직 수정:** `AuthContext.tsx`의 오류 처리 로직을 다양한 방식으로 수차례 수정했으나, 실제 `fetch` 통신만 포함되면 `[object Object]` 오류 재발.
  2. **강제 오류 테스트:** 네트워크 통신을 제거한 테스트에서는 한글 오류 메시지가 정상적으로 표시됨을 확인. -> **이를 통해 코드 자체의 논리보다는, `fetch` 실패 시의 환경적 요인이 문제임을 확인함.**
  3. **개발 환경 초기화:** `node_modules`, `.expo`, `npm cache` 등 모든 캐시를 삭제하고 Expo Go 앱을 재설치하는 '완전 초기화'를 진행했으나 문제 해결 실패.
  4. **충돌 오류 수정:** 라우터가 준비된 후에만 화면 이동을 시도하도록 `AuthContext.tsx`에 안전장치를 추가했으나, 이 수정사항조차 앱에 반영되지 않고 동일한 충돌 오류 발생.

### ✅ 최종 진단 및 상태
- **완료된 기능:** 사용자 인증, 실시간 박스오피스, 영화 상세정보, 평점 저장, 초기 추천 기능, 로그아웃, 아이디/이메일 중복 확인 등 제안서의 모든 핵심 기능 프로토타입.
- **미해결 문제:** **Expo/Metro 개발 환경의 고질적인 캐시 문제.** 코드 수정사항이, 특히 네트워크 오류 처리와 관련된 `AuthContext.tsx` 파일의 변경사항이 사용자 기기에 제대로 반영되지 않고 있음.
- **현재 상태:** 추가적인 앱 충돌을 막기 위해, `AuthContext.tsx`는 실제 로그인/회원가입을 시도하지 않고 항상 정해진 한글 오류 메시지만을 표시하는 **안정화된 임시 버전**으로 저장되어 있음.

### 📝 다음 세션을 위한 제안
- **목표:** 사용자의 로컬 개발 환경을 안정시킨 후, 현재의 임시 코드를 실제 동작하는 코드로 되돌려 최종 테스트를 진행.
- **사용자 권장 사항:**
  1. 컴퓨터 재부팅
  2. 다른 네트워크(핫스팟 등)에서 테스트
  3. Homebrew를 사용한다면 `brew reinstall watchman`, `brew reinstall node` 시도
